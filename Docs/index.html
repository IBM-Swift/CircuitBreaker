<!DOCTYPE html>
<html lang="en">
  <head>
    <title>  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html"> Docs</a> (0% documented)</p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html"> Reference</a>
        <img id="carat" src="img/carat.png" />
          Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <p><a href="https://travis-ci.com/IBM-Swift/CircuitBreaker"><img src="https://travis-ci.com/IBM-Swift/CircuitBreaker.svg?token=zkW1banusRzgHu6HwJiN&branch=master" alt="Build Status"></a>
<img src="https://img.shields.io/badge/os-macOS-green.svg?style=flat" alt="macOS">
<img src="https://img.shields.io/badge/os-linux-green.svg?style=flat" alt="Linux"></p>
<h1 id='circuitbreaker' class='heading'>CircuitBreaker</h1>

<p>The Circuit Breaker design pattern is used to increase application stability, improve response time, and prevent the application from making constant failing requests. This library provides the tools needed to bring Circuit Breaker logic to your Swift applications.</p>

<p><img src="Docs/circuitBreakerDiagram.png" alt="Circuit Breaker Diagram"></p>
<h2 id='contents' class='heading'>Contents</h2>

<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#advanced-usage">Advanced Usage</a></li>
<li><a href="#api">API</a></li>
</ul>
<h2 id='swift-version' class='heading'>Swift version</h2>

<p>The latest version of CircuitBreaker works with the <code>3.1.1</code> and newer version of the Swift binaries. You can download this version of the Swift binaries by following this <a href="https://swift.org/download/#releases">link</a>.</p>
<h2 id='installation' class='heading'>Installation</h2>

<p>To leverage the CircuitBreaker package in your Swift application, you should specify a dependency for it in your <code>Package.swift</code> file:</p>
<pre class="highlight swift"><code> <span class="kd">import</span> <span class="kt">PackageDescription</span>

 <span class="k">let</span> <span class="nv">package</span> <span class="o">=</span> <span class="kt">Package</span><span class="p">(</span>
     <span class="nv">name</span><span class="p">:</span> <span class="s">"MySwiftProject"</span><span class="p">,</span>

     <span class="o">...</span>

     <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
         <span class="c1">// Swift 3</span>
         <span class="o">.</span><span class="kt">Package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/IBM-Swift/CircuitBreaker.git"</span><span class="p">,</span> <span class="nv">majorVersion</span><span class="p">:</span> <span class="mi">2</span><span class="p">),</span>

         <span class="c1">// Swift 4</span>
         <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/IBM-Swift/CircuitBreaker.git"</span><span class="p">,</span> <span class="o">.</span><span class="nf">upToNextMajor</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="s">"2.0.0"</span><span class="p">)),</span>
         <span class="o">...</span>

     <span class="p">])</span>
</code></pre>
<h3 id='basic-usage' class='heading'>Basic Usage</h3>

<p><em>In this form of usage, the CircuitBreaker state is based on timeouts only.</em></p>

<p>If the function you are circuit breaking makes an asynchronous call(s) and the execution time of that call should be taking into account, then see <a href="#advanced-usage"><code>Advanced Usage</code></a> below.</p>

<ol>
<li><p>Define a fallback function with the signature <code>(&lt;BreakerError, (fallbackArg1, fallbackArg2,...)&gt;) -&gt; Void</code>:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">myFallback</span><span class="p">(</span><span class="nv">err</span><span class="p">:</span> <span class="kt">BreakerError</span><span class="p">,</span> <span class="nv">msg</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">// The fallback will be called if the request does not return before the specified timeout</span>
<span class="c1">// or if the CircuitBreaker is currently in Open state and set to fail fast.</span>
<span class="c1">// Client code can use the fallback function to do alternate processing, such as show an error page.</span>
<span class="kt">Log</span><span class="o">.</span><span class="nf">verbose</span><span class="p">(</span><span class="s">"Error: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="kt">Log</span><span class="o">.</span><span class="nf">verbose</span><span class="p">(</span><span class="s">"Message: </span><span class="se">\(</span><span class="n">msg</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></li>
<li><p>Create a function to circuit break:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">myFunction</span><span class="p">(</span><span class="nv">a</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">b</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
<span class="c1">// do stuff</span>
<span class="k">let</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="o">...</span>
<span class="k">return</span> <span class="n">value</span>
<span class="p">}</span>
</code></pre></li>
<li><p>Create a CircuitBreaker instance for each endpoint you wish to circuit break:</p>

<ul>
<li>Must specify the fallback function, and the endpoint to circuit break</li>
<li>Optional configurations include: timeout, resetTimeout, maxFailures, and bulkhead
<code>swift
let breaker = CircuitBreaker(command: myFunction, fallback: myFallback)
</code></li>
</ul></li>
<li><p>Invoke the call to the function by calling the CircuitBreaker <code>run()</code> method. You should pass the corresponding arguments for the command and fallback closures. In this sample, <code>myFunction</code> takes two integers as parameters while <code>myFallback</code> takes a string as its second parameter:</p></li>
</ol>
<pre class="highlight swift"><code><span class="n">breaker</span><span class="o">.</span><span class="nf">run</span><span class="p">(</span><span class="nv">commandArgs</span><span class="p">:</span> <span class="p">(</span><span class="nv">a</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="nv">b</span><span class="p">:</span> <span class="mi">20</span><span class="p">),</span> <span class="nv">fallbackArgs</span><span class="p">:</span> <span class="p">(</span><span class="nv">msg</span><span class="p">:</span> <span class="s">"Something went wrong."</span><span class="p">))</span>
</code></pre>

<ul>
<li>May be called multiple times with varied input:
<code>swift
breaker.run(commandArgs: (a: 15, b: 35), fallbackArgs: (msg: &quot;Something went wrong.&quot;))
</code></li>
</ul>

<p>Full Implementation:</p>
<pre class="highlight swift"><code><span class="o">...</span>

<span class="kd">func</span> <span class="nf">myFallback</span><span class="p">(</span><span class="nv">err</span><span class="p">:</span> <span class="kt">BreakerError</span><span class="p">,</span> <span class="nv">msg</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// The fallback will be called if the request does not return before the specified timeout</span>
    <span class="c1">// or if the CircuitBreaker is currently in Open state and set to fail fast.</span>
    <span class="c1">// Client code can use the fallback function to do alternate processing, such as show an error page.</span>
    <span class="kt">Log</span><span class="o">.</span><span class="nf">verbose</span><span class="p">(</span><span class="s">"Error: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="kt">Log</span><span class="o">.</span><span class="nf">verbose</span><span class="p">(</span><span class="s">"Message: </span><span class="se">\(</span><span class="n">msg</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">myFunction</span><span class="p">(</span><span class="nv">a</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">b</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
    <span class="c1">// do stuff</span>
    <span class="k">let</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="o">...</span>
    <span class="k">return</span> <span class="n">value</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">breaker</span> <span class="o">=</span> <span class="kt">CircuitBreaker</span><span class="p">(</span><span class="nv">command</span><span class="p">:</span> <span class="n">myFunction</span><span class="p">,</span> <span class="nv">fallback</span><span class="p">:</span> <span class="n">myFallback</span><span class="p">)</span>

<span class="n">breaker</span><span class="o">.</span><span class="nf">run</span><span class="p">(</span><span class="nv">commandArgs</span><span class="p">:</span> <span class="p">(</span><span class="nv">a</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="nv">b</span><span class="p">:</span> <span class="mi">20</span><span class="p">),</span> <span class="nv">fallbackArgs</span><span class="p">:</span> <span class="p">(</span><span class="nv">msg</span><span class="p">:</span> <span class="s">"Something went wrong."</span><span class="p">))</span>
<span class="n">breaker</span><span class="o">.</span><span class="nf">run</span><span class="p">(</span><span class="nv">commandArgs</span><span class="p">:</span> <span class="p">(</span><span class="nv">a</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="nv">b</span><span class="p">:</span> <span class="mi">35</span><span class="p">),</span> <span class="nv">fallbackArgs</span><span class="p">:</span> <span class="p">(</span><span class="nv">msg</span><span class="p">:</span> <span class="s">"Something went wrong."</span><span class="p">))</span>

<span class="o">...</span>
</code></pre>
<h3 id='advanced-usage' class='heading'>Advanced Usage</h3>

<p><em>In this form of usage, the CircuitBreaker state is based on timeouts and user defined failures (quite useful when the function you are circuit breaking makes an asynchronous call).</em></p>

<ol>
<li><p>Define a fallback function with the signature <code>(&lt;BreakerError, (fallbackArg1, fallbackArg2,...)&gt;) -&gt; Void</code>:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">myFallback</span><span class="p">(</span><span class="nv">err</span><span class="p">:</span> <span class="kt">BreakerError</span><span class="p">,</span> <span class="nv">msg</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">// The fallback will be called if the request does not return before the specified timeout</span>
<span class="c1">// or if the CircuitBreaker is currently in Open state and set to fail fast.</span>
<span class="kt">Log</span><span class="o">.</span><span class="nf">verbose</span><span class="p">(</span><span class="s">"Error: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="kt">Log</span><span class="o">.</span><span class="nf">verbose</span><span class="p">(</span><span class="s">"Message: </span><span class="se">\(</span><span class="n">msg</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></li>
<li><p>Create a context function for the logic you intend to circuit break (this allows you to alert the CircuitBreaker of a failure or a success). Please note that a context function receives an <code>Invocation</code> object as its parameter. An instance of the <code>Invocation</code> class states 1) the parameter types that must be passed to the context function, 2) the return type from the execution of the context function, and 3) parameter type used as the second argument for the fallback closure:</p></li>
</ol>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">myContextFunction</span><span class="p">(</span><span class="nv">invocation</span><span class="p">:</span> <span class="kt">Invocation</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">String</span><span class="p">),</span> <span class="kt">Void</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">requestParam</span> <span class="o">=</span> <span class="n">invocation</span><span class="o">.</span><span class="n">commandArgs</span>
  <span class="c1">// Create HTTP request</span>
  <span class="k">guard</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"http://mysever.net/path/</span><span class="se">\(</span><span class="n">requestParam</span><span class="se">)</span><span class="s">"</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Something went wrong...</span>

    <span class="o">...</span>

    <span class="n">invocation</span><span class="o">.</span><span class="nf">notifyFailure</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">var</span> <span class="nv">req</span> <span class="o">=</span> <span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
  <span class="n">req</span><span class="o">.</span><span class="n">httpMethod</span> <span class="o">=</span> <span class="s">"GET"</span>
  <span class="n">req</span><span class="o">.</span><span class="n">allHTTPHeaderFields</span> <span class="o">=</span> <span class="p">[</span><span class="s">"Content-Type"</span><span class="p">:</span> <span class="s">"application/json"</span><span class="p">]</span>
  <span class="k">let</span> <span class="nv">session</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span>

  <span class="c1">// Perform Request</span>
  <span class="n">session</span><span class="o">.</span><span class="nf">dataTask</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">req</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">err</span> <span class="k">in</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="n">result</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// Failed getting a result from the server</span>

      <span class="o">...</span>

      <span class="n">invocation</span><span class="o">.</span><span class="nf">notifyFailure</span><span class="p">()</span>
      <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">// Convert results to a JSON object</span>
    <span class="k">let</span> <span class="nv">json</span> <span class="o">=</span> <span class="kt">JSON</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">result</span><span class="p">)</span>
    <span class="c1">// Process JSON data</span>

    <span class="o">...</span>

    <span class="n">invocation</span><span class="o">.</span><span class="nf">notifySuccess</span><span class="p">()</span>
  <span class="p">}</span><span class="o">.</span><span class="nf">resume</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>

<ol>
<li><p>Create a CircuitBreaker instance for each context function (e.g. endpoint) you wish to circuit break:</p>

<ul>
<li>Must specify the fallback function and the endpoint to circuit break</li>
<li>Optional configurations include: timeout, resetTimeout, maxFailures, rollingWindow, and bulkhead
<code>swift
let breaker = CircuitBreaker(contextCommand: myContextFunction, fallback: myFallback)
</code></li>
</ul></li>
<li><p>Invoke the call to the endpoint by calling the CircuitBreaker <code>run()</code> method. You should pass the corresponding arguments for the context command and fallback closures. In this sample, <code>myContextFunction</code> takes a string as its parameter while <code>myFallback</code> takes a string as its second parameter:</p></li>
</ol>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">breaker</span><span class="o">.</span><span class="nf">run</span><span class="p">(</span><span class="nv">commandArgs</span><span class="p">:</span> <span class="n">id</span><span class="p">,</span> <span class="nv">fallbackArgs</span><span class="p">:</span> <span class="p">(</span><span class="nv">msg</span><span class="p">:</span> <span class="s">"Something went wrong."</span><span class="p">))</span>
</code></pre>

<p>Full Implementation:</p>
<pre class="highlight swift"><code><span class="o">...</span>

<span class="kd">func</span> <span class="nf">myFallback</span><span class="p">(</span><span class="nv">err</span><span class="p">:</span> <span class="kt">BreakerError</span><span class="p">,</span> <span class="nv">msg</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// The fallback will be called if the request does not return before the specified timeout</span>
    <span class="c1">// or if the CircuitBreaker is currently in Open state and set to fail fast.</span>
    <span class="kt">Log</span><span class="o">.</span><span class="nf">verbose</span><span class="p">(</span><span class="s">"Error: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="kt">Log</span><span class="o">.</span><span class="nf">verbose</span><span class="p">(</span><span class="s">"Message: </span><span class="se">\(</span><span class="n">msg</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">myContextFunction</span><span class="p">(</span><span class="nv">invocation</span><span class="p">:</span> <span class="kt">Invocation</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">String</span><span class="p">),</span> <span class="kt">Void</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">requestParam</span> <span class="o">=</span> <span class="n">invocation</span><span class="o">.</span><span class="n">commandArgs</span>
  <span class="c1">// Create HTTP request</span>
  <span class="k">guard</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"http://mysever.net/path/</span><span class="se">\(</span><span class="n">requestParam</span><span class="se">)</span><span class="s">"</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Something went wrong...</span>

    <span class="o">...</span>

    <span class="n">invocation</span><span class="o">.</span><span class="nf">notifyFailure</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">var</span> <span class="nv">req</span> <span class="o">=</span> <span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
  <span class="n">req</span><span class="o">.</span><span class="n">httpMethod</span> <span class="o">=</span> <span class="s">"GET"</span>
  <span class="n">req</span><span class="o">.</span><span class="n">allHTTPHeaderFields</span> <span class="o">=</span> <span class="p">[</span><span class="s">"Content-Type"</span><span class="p">:</span> <span class="s">"application/json"</span><span class="p">]</span>
  <span class="k">let</span> <span class="nv">session</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span>

  <span class="c1">// Perform Request</span>
  <span class="n">session</span><span class="o">.</span><span class="nf">dataTask</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">req</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">err</span> <span class="k">in</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="n">result</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// Failed getting a result from the server</span>

      <span class="o">...</span>

      <span class="n">invocation</span><span class="o">.</span><span class="nf">notifyFailure</span><span class="p">()</span>
      <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">// Convert results to a JSON object</span>
    <span class="k">let</span> <span class="nv">json</span> <span class="o">=</span> <span class="kt">JSON</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">result</span><span class="p">)</span>
    <span class="c1">// Process JSON data</span>

    <span class="o">...</span>

    <span class="n">invocation</span><span class="o">.</span><span class="nf">notifySuccess</span><span class="p">()</span>
  <span class="p">}</span><span class="o">.</span><span class="nf">resume</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">breaker</span> <span class="o">=</span> <span class="kt">CircuitBreaker</span><span class="p">(</span><span class="nv">contextCommand</span><span class="p">:</span> <span class="n">myContextFunction</span><span class="p">,</span> <span class="nv">fallback</span><span class="p">:</span> <span class="n">myFallback</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">breaker</span><span class="o">.</span><span class="nf">run</span><span class="p">(</span><span class="nv">commandArgs</span><span class="p">:</span> <span class="n">id</span><span class="p">,</span> <span class="nv">fallbackArgs</span><span class="p">:</span> <span class="p">(</span><span class="nv">msg</span><span class="p">:</span> <span class="s">"Something went wrong."</span><span class="p">))</span>

<span class="o">...</span>
</code></pre>
<h2 id='api' class='heading'>API</h2>
<h3 id='circuitbreaker' class='heading'>CircuitBreaker</h3>
<h4 id='basic-usage-constructor' class='heading'>Basic Usage Constructor</h4>
<pre class="highlight swift"><code><span class="kt">CircuitBreaker</span><span class="p">(</span><span class="nv">timeout</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="nv">resetTimeout</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">60000</span><span class="p">,</span> <span class="nv">maxFailures</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="nv">rollingWindow</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span> <span class="nv">bulkhead</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">command</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="kt">AnyFunction</span><span class="o">&lt;</span><span class="kt">A</span><span class="p">,</span> <span class="kt">B</span><span class="o">&gt;</span><span class="p">,</span> <span class="nv">fallback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="kt">AnyFallback</span><span class="o">&lt;</span><span class="kt">C</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre>
<h4 id='advanced-usage-constructor' class='heading'>Advanced Usage Constructor</h4>
<pre class="highlight swift"><code><span class="kt">CircuitBreaker</span><span class="p">(</span><span class="nv">timeout</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="nv">resetTimeout</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">60000</span><span class="p">,</span> <span class="nv">maxFailures</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="nv">rollingWindow</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span> <span class="nv">bulkhead</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">contextCommand</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="kt">AnyContextFunction</span><span class="o">&lt;</span><span class="kt">A</span><span class="p">,</span> <span class="kt">B</span><span class="o">&gt;</span><span class="p">,</span> <span class="nv">fallback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="kt">AnyFallback</span><span class="o">&lt;</span><span class="kt">C</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre>
<h4 id='constructor-parameters' class='heading'>Constructor parameters</h4>

<ul>
<li><code>timeout</code> Amount in milliseconds that your function should complete before the invocation is considered a failure. Default is set to 1000 milliseconds.</li>
<li><code>resetTimeout</code> Amount in milliseconds to wait before setting to halfopen state. Default is set to 60000 milliseconds.</li>
<li><code>maxFailures</code> Number of failures allowed within <code>rollingWindow</code> before setting state to open. Default is set to 5.</li>
<li><code>rollingWindow</code> Time window in milliseconds where the maximum number of failures must occur to trip the circuit. For instance, say <code>maxFailures</code> is 5 and <code>rollingWindow</code> is 10000 milliseconds. In such case, for the circuit to trip, 5 invocation failures must occur in a time window of 10 seconds, even if these failures are not consecutive. Default is set to 10000 milliseconds.</li>
<li><code>bulkhead</code> Number of the limit of concurrent requests running at one time. Default is set to 0, which is equivalent to not using the bulkheading feature.</li>
<li><code>fallback</code> Function user specifies to signal timeout or fastFail completion. Required format: <code>(BreakerError, (fallbackArg1, fallbackArg2,...)) -&gt; Void</code></li>
<li><code>command</code> Function to circuit break (basic usage constructor).</li>
<li><code>contextCommand</code> Contextual function to circuit break, which allows user defined failures (the context provides an indirect reference to the corresponding circuit breaker instance; advanced usage constructor).</li>
</ul>
<h3 id='stats' class='heading'>Stats</h3>
<pre class="highlight swift"><code><span class="o">...</span>
<span class="c1">// Create CircuitBreaker</span>
<span class="k">let</span> <span class="nv">breaker</span> <span class="o">=</span> <span class="kt">CircuitBreaker</span><span class="p">(</span><span class="nv">command</span><span class="p">:</span> <span class="n">myFunction</span><span class="p">,</span> <span class="nv">fallback</span><span class="p">:</span> <span class="n">myFallback</span><span class="p">)</span>

<span class="c1">// Invoke breaker call</span>
<span class="n">breaker</span><span class="o">.</span><span class="nf">run</span><span class="p">(</span><span class="nv">commandArgs</span><span class="p">:</span> <span class="p">(</span><span class="nv">a</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="nv">b</span><span class="p">:</span> <span class="mi">20</span><span class="p">),</span> <span class="nv">fallbackArgs</span><span class="p">:</span> <span class="p">(</span><span class="nv">msg</span><span class="p">:</span> <span class="s">"Something went wrong."</span><span class="p">))</span>

<span class="c1">// Log Stats snapshot</span>
<span class="n">breaker</span><span class="o">.</span><span class="nf">snapshot</span><span class="p">()</span>
<span class="o">...</span>
</code></pre>
<h4 id='tracked-stats' class='heading'>Tracked Stats:</h4>

<ul>
<li>Total Requests</li>
<li>Concurrent Requests</li>
<li>Rejected Requests</li>
<li>Successful Responses</li>
<li>Average Response Time</li>
<li>Failed Responses</li>
<li>Total Timeouts</li>
<li>Total Latency</li>
</ul>
<h2 id='license' class='heading'>License</h2>

<p>This Swift package is licensed under Apache 2.0. Full license text is available in <a href="LICENSE">LICENSE</a>.</p>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2017 <a class="link" href="" target="_blank" rel="external"></a>. All rights reserved. (Last updated: 2017-11-14)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.8.4</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
